- 웹 캐시는 자주 쓰이는 문서의 사본은 자동으로 보관하는 HTTP 장치
- 캐시가 주는 혜택
  1. 캐시는 불필요한 데이터 전송을 줄여서, 네트워크 요금으로 인한 비용을 줄여준다.
  2. 캐시는 네트워크 병목을 줄여준다. 대역폭을 늘리지 않고도 페이지를 빨리 불러올 수 있게 된다.
  3. 캐시는 원 서버에 대한 요청을 줄여준다. 서버는 부하를 줄일 수 있으며 더 빨리 응답할 수 있게 된다.
  4. 페이지를 먼 곳에서 불러올수록 시간이 많이 걸리는데, 캐시는 거리로 인한 지연을 줄여준다.

## 7.1 불필요한 데이터 전송

- 복수의 클라이언트가 자주 쓰이는 원 서버 페이지에 접근할 때, 서버는 같은 문서를 클라이언트들에게 각각 한 번씩 전송한다.
- 똑같은 바이트들이 네트워크를 통해 계속 반복해서 이동한다.
- 이 불필요한 데이터는 네트워크 대역폭을 잡아먹고, 전송을 느리게 만들며, 웹 서버에 부하를 준다.
- 첫 번째 응답을 캐시에 보관하여 다음에 오는 요청을에 대한 응답으로 사용할 수 있다.

## 7.2 대역폭 병목

- 캐시는 네트워크의 병목을 줄여준다.
- 만약 클라이언트가 빠른 LAN에 있는 캐시로부터 사본을 가져온다면, 캐싱은 성능을 대폭 개선할 수 있을 것이다.

  > LAN (Local Area Network)란?
  >
  > - 사용자가 포함된 지역 네트워크를 의미
  > - 쉽게 말하면 학교, 회사, 집에서 컴퓨터, IP 전화기, 프린터 등의 장비를 서로 연결한 것
  > - LAN은 구성할 때 드는 비용과 전기세를 빼고는 유지보수비가 들지 않음
  > - LAN은 이더넷 이라는 프로토콜을 주로 사용  
  >   ![LAN](https://github.com/kimmin-ko/HTTP-The-Definitive-Guide/blob/master/images/lan1.jpg?raw=true)

  > WAN (Wide Area Network)란?
  >
  > - LAN과 LAN 사이를 광범위한 지역 단위로 구성하는 네트워크
  > - ISP(Internet Service Provider: SK, KT, LG) 네트워크망을 통해 LAN과 LAN을 연결
  > - 우리가 사용하는 네트워크는 작은 네트워크들이 서로 합쳐져서 커지고 또 합쳐져서 하나의 큰 네트워크가 됨  
  >   ![WAN](https://github.com/kimmin-ko/HTTP-The-Definitive-Guide/blob/master/images/wan.jpg?raw=true)

  > 이더넷 (Ethernet)이란?
  >
  > - 사무실, 학교, PC방 등의 LAN 환경에서 거의 절대 다수를 차지하는 네트워크 구성 방식
  > - 네트워킹의 한 방식이며, 네트워크를 만드는 방법 중 하나라고 생각하면 됨
  > - 이더넥의 가장 큰 특징은 CSMA/CD라는 프로토콜을 사용해서 통신하는 것

  > CSMA/CS (Carrier Sense Multiple Access / Collision Detection)란?
  >
  > - 이더넷 환경에서 통신을 하고 싶은 PC나 서버는 먼저 지금 네트워크 상에 통신이 일어나고 있는지 확인(Carrier Sense), 있다면 자기가 보낼 정보를 가지고 기다리다가 네트워크에서 통신이 없어지면 자신의 데이터를 네트워크 상에 실어서 보냄
  > - 만약 두 대의 PC나 서버가 기다리다가 동시에 보내는 경우(Multiple Access)가 발생
  > - 통신은 이렇게 두 개의 장비들이 데이터를 동시에 보내려다가 부딪치는 경우를 충돌(Collision)이 발생했다고 말함
  > - 충돌이 발생하게 되면 데이터를 전송했던 PC들은 랜덤한 시간동안 기다린 다음 다시 데이터를 전송함
  > - 그래서 이더넷에서는 너무 많은 충돌이 발생하면 통신 자체가 불가능해지는 경우도 발생

- 샌프란시스코 지사에서 애틀란티스 본사로부터 5MB 크기의 문서를 받는다면 30초가 걸릴 수 있지만, 샌프란시스코 지사 사무실에 캐시되어 있다면 1초 미만이 걸릴 것이다.

## 7.3 갑작스런 요청 쇄도 (Flash Crowds)

- 캐싱은 갑작스런 사건으로 인해 트래픽이 몰릴 때 대처하기 위해 중요하다.
- 1998년 클린턴 미 대통령의 조사에 대한 내용이 담긴 보고서가 인터넷을 통해 공개되었는데 이 웹 사이트는 한 시간 동안 3백만 건이 넘는 요청을 받았다.

## 7.4 거리로 인한 지연

- 대역폭이 문제가 되지 않더라도, 거리가 문제 될 수 있다. 모든 네트워크 라우터는 제각각 인터넷 트래픽을 지연시킨다.
- 클라이언트와 서버 사이에 라우터가 많지 않더라도, 빛의 속도 그 자체가 유의미한 지연을 유발한다.

## 7.5 적중과 부적중

- 캐시가 세상 모든 문서의 사본을 저장하지는 않는다. (용량 부족)
- 캐시에 요청이 도착했을 때, 사본이 있다면 그것을 이용해 요청을 처리 (적중)
- 사본이 없다면 그냥 원 서버로 전달 (부적중)

### 1) 재검사 (Revalidation)

- 서버의 콘텐츠가 변경될 수 있기 때문에 캐시는 사본이 최신인지 서버를 통해 점검해야한다.
- HTTP는 캐시된 객체를 재확인하기 위해 몇 가지 도구를 제공하는데 가장 많이 쓰이는 것은 If-Modified-Since 헤더이다.
- 서버에게 보내는 GET 요청에 이 헤더를 추가하면 캐시된 시간 이후에 변경된 경우에만 사본을 보내달라는 의미가 된다.
- GET If-Modified-Sice 요청이 서버에 도착했을 때 세 가지 상황

  1. _재검사 적중_  
     서버 객체가 변경되지 않았다면, 서버는 클라이언트에게 작은 HTTP 304 Not Modified 응답을 보낸다.
  2. _재검사 부적중_
     서버 객체가 캐시된 사본과 다르다면, 서버는 콘텐츠 전체와 함께 HTTP 200 OK 응답을 클라이언트에게 보낸다.
  3. _객체 삭제_
     서버 객체가 삭제되었다면, 서버는 404 Not Fount 응답을 돌려보내며, 캐시는 사본을 삭제한다.

### 2) 적중률

- 캐시가 요청을 처리하는 비율을 캐시 적중률 혹은 문서 적중률이라고 부른다.
- 오늘날 적중률 40%면 웹 캐시로 괜찮은 편이다.

### 3) 바이트 적중률

- 문서들의 크기가 모두 다르기 때문에 캐시 적중률이 모든 것을 말해주지 않는다. 몇몇 큰 객체는 덜 접근되지만 그 크기 때문에 전체 트래픽에는 더 크게 기여한다.
- 바이트 단위 적중률은 캐시를 통해 제공된 모든 바이트의 비율을 표현한다.

### 4) 적중과 부적중 구별

- 클라이언트는 응답의 Date 헤더나 Age 헤더를 통해 응답이 캐시로부터 온 것인지 서버로부터 온 것인지 구별할 수 있다. (캐시 응답의 경우 현재 시각과 비교할 때 더 오래되었다)

## 7.6 캐시 토폴로지

- 한 명에게만 할당된 캐시를 개인 전용 캐시(private cache)라 부르고 수천 명이 공유하는 캐시를 공용 캐시(public cache)라고 부른다.

### 1) 개인 전용 캐시

- 개인 전용 캐시는 많은 저장 공간을 필요로 하지 않으므로, 작고 저렴할 수 있다.
- 웹 브라우저는 개인 전용 캐시를 내장하고 있다.

### 2) 공용 프락시 캐시

- 공용 캐시는 캐시 프락시 서버 혹은 더 흔히 프락시 캐시라고 불리는 특별한 종류의 공유된 프락시 서버다.

### 3) 프락시 캐시 계층들

- 작은 캐시에서 캐시 부적중이 발생했을 때 더 큰 부모 캐시가 그 '걸러 남겨진' 트래픽을 처리하도록 하는 계층을 만드는 방식이 합리적인 경우가 많다.
  > _**나의 생각**_  
  > 개인 컴퓨터의 웹 브라우저에는 나만의 캐시가 있다.  
  > 그 캐시에서 캐시 부적중이 발생한다면 LAN 단위의 캐시(공용 캐시)가 그 요청을 처리할 수 있다.

### 4) 캐시망, 콘텐츠 라우팅, 피어링

-
